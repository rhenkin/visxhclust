<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Documenting a workflow • visxhclust</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Documenting a workflow">
<meta property="og:description" content="visxhclust">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">visxhclust</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/visxhclust.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/clusterevaluation.html">Documenting evaluation</a>
    </li>
    <li>
      <a href="../articles/clusterworkflow.html">Documenting a workflow</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rhenkin/visxhclust/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Documenting a workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rhenkin/visxhclust/blob/HEAD/vignettes/clusterworkflow.Rmd" class="external-link"><code>vignettes/clusterworkflow.Rmd</code></a></small>
      <div class="hidden name"><code>clusterworkflow.Rmd</code></div>

    </div>

    
    
<p>This document shows how to use some functions included in the package
to document and reproduce a clustering workflow from the app. Although
these functions do not cover all the steps such as selecting features,
they allow users of the Shiny app to show the resulting heatmaps and
boxplots. The example dataset used here is the <code>iris</code>
dataset.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rhenkin/visxhclust" class="external-link">visxhclust</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="preparing">Preparing<a class="anchor" aria-label="anchor" href="#preparing"></a>
</h3>
<p>First we split the numeric and categorical variables and scale the
data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">numeric_data</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">annotation_data</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s check the dataset for highly correlated variables that will
likely skew the clusters with redundant information:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/correlation_heatmap.html">correlation_heatmap</a></span><span class="op">(</span><span class="va">numeric_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="clusterworkflow_files/figure-html/correlation-1.png" width="700"></p>
<p>As seen above, petal length and width are highly correlated, so we
keep only one of them:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subset_data</span> <span class="op">&lt;-</span> <span class="va">numeric_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">Sepal.Length</span>, <span class="va">Sepal.Width</span>, <span class="va">Petal.Width</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="clustering">Clustering<a class="anchor" aria-label="anchor" href="#clustering"></a>
</h3>
<p>The clustering itself takes three steps: computing a distance matrix,
computing the hierarchical clusters and cutting the tree to find the
desired number of clusters. In the app, each of these steps has matching
parameters: apply scaling and distance/similarity metric, linkage method
and the number of clusters.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scaling</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">distance_method</span> <span class="op">&lt;-</span> <span class="st">"euclidean"</span></span>
<span><span class="va">linkage_method</span> <span class="op">&lt;-</span> <span class="st">"ward.D2"</span></span>
<span><span class="co"># this assumes that, in the app, we identified 3 as the optimal number of clusters</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">3</span> </span></code></pre></div>
<p>These parameters are used in three functions that the app also uses:
<code>compute_dmat</code>, <code>compute_clusters</code> and
<code>cut_clusters</code>. You can check the documentation for each
function in the package website, or interactively through
<code><a href="../reference/compute_dmat.html">?compute_dmat</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_dmat.html">compute_dmat</a></span><span class="op">(</span><span class="va">subset_data</span>, <span class="va">distance_method</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_clusters.html">compute_clusters</a></span><span class="op">(</span><span class="va">dmat</span>, <span class="va">linkage_method</span><span class="op">)</span></span>
<span><span class="va">cluster_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cut_clusters.html">cut_clusters</a></span><span class="op">(</span><span class="va">clusters</span>, <span class="va">k</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<p>Now we can check both the heatmap+dendrogram and boxplots. A function
that covers most steps to produce the heatmap is included in the
package, with the name: <code><a href="../reference/cluster_heatmaps.html">cluster_heatmaps()</a></code>. It plots the
dendrogram, the annotation layer, the clustered data heatmap and the
heatmap with the rest of the data not used for clustering. In the Shiny
app this is done automatically, but outside, plotting the annotation and
the unselected data are optional steps; the annotations require an extra
step with the function <code><a href="../reference/create_annotations.html">create_annotations()</a></code>. The colors
used in the app are also exported by the package as the variable
<code>cluster_colors</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species_annotation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_annotations.html">create_annotations</a></span><span class="op">(</span><span class="va">iris</span>, <span class="st">"Species"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cluster_heatmaps.html">cluster_heatmaps</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">subset_data</span><span class="op">)</span>, </span>
<span>                 <span class="va">clusters</span>,</span>
<span>                 <span class="va">k</span>,</span>
<span>                 <span class="va">cluster_colors</span>,</span>
<span>                 annotation <span class="op">=</span> <span class="va">species_annotation</span><span class="op">)</span></span></code></pre></div>
<p><img src="clusterworkflow_files/figure-html/heatmap-1.png" width="700">
In addition to the heatmap, the boxplots in the app are also available
through functions. There are two steps required to show data through box
plots: annotating the original data with the cluster and plotting
it.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">annotated_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/annotate_clusters.html">annotate_clusters</a></span><span class="op">(</span><span class="va">subset_data</span>, <span class="va">cluster_labels</span>, <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cluster_boxplots.html">cluster_boxplots</a></span><span class="op">(</span><span class="va">annotated_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="clusterworkflow_files/figure-html/boxplots-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rafael Henkin.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
